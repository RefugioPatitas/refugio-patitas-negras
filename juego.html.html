<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refugio Patitas Negras</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;,">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
            min-height: 100vh;
            color: #333;
            padding: 15px;
            padding-bottom: 80px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 25px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        h1 { font-size: 2.2em; margin-bottom: 5px; color: #FFD700; }
        .tagline { font-size: 1em; opacity: 0.9; margin-bottom: 20px; color: #ecf0f1; }
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border-left: 6px solid #3498db;
        }
        .refugio-header { border-left-color: #e74c3c; background: rgba(255, 255, 255, 0.98); }
        .animals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .animal-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }
        .animal-card:hover { transform: translateY(-5px); border-color: #3498db; box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); }
        .animal-avatar { font-size: 2.8em; margin-bottom: 10px; }
        .hidden { display: none !important; }
        .main-game-area { display: flex; flex-direction: column; gap: 25px; }
        .avatar-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 20px;
        }
        @media (min-width: 768px) {
            .avatar-section { flex-direction: row; text-align: left; }
        }
        .animal-large { font-size: 5em; min-width: 120px; text-align: center; }
        .animal-status { flex-grow: 1; }
        #animal-display { transition: all 0.5s ease; }
        #refugio-name {
            font-size: 1.8em;
            color: #2c3e50;
            text-align: center;
            margin: 10px 0 20px 0;
            font-weight: bold;
        }
        .stats-container { width: 100%; }
        .stat {
            margin: 12px 0;
        }
        .stat-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-bar {
            height: 22px;
            background: #ecf0f1;
            border-radius: 11px;
            overflow: hidden;
        }
        .stat-fill {
            height: 100%;
            border-radius: 11px;
            transition: width 0.7s ease, background 0.5s;
        }
        #oficio-bar { background: linear-gradient(90deg, #e67e22, #f39c12); width: 65%; }
        #saber-bar { background: linear-gradient(90deg, #3498db, #2980b9); width: 40%; }
        #corazon-bar { background: linear-gradient(90deg, #e74c3c, #c0392b); width: 80%; }
        .activities-section { background: #ffffff; }
        .activity-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        .activity-btn {
            padding: 16px 8px;
            border: none;
            border-radius: 12px;
            background: #3498db;
            color: white;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 70px;
        }
        .activity-btn:hover { background: #2980b9; transform: scale(1.05); }
        .activity-btn.oficio { background: #e67e22; }
        .activity-btn.oficio:hover { background: #d35400; }
        .activity-btn.saber { background: #3498db; }
        .activity-btn.saber:hover { background: #2980b9; }
        .activity-btn.corazon { background: #e74c3c; }
        .activity-btn.corazon:hover { background: #c0392b; }
        .special-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .special-btn {
            padding: 12px 20px;
            border: 2px solid;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #btn-alimentar { border-color: #e74c3c; color: #e74c3c; }
        #btn-alimentar:hover { background: #e74c3c; color: white; }
        #btn-cambiar { border-color: #9b59b6; color: #9b59b6; }
        #btn-cambiar:hover { background: #9b59b6; color: white; }
        #btn-reiniciar { border-color: #7f8c8d; color: #7f8c8d; }
        #btn-reiniciar:hover { background: #7f8c8d; color: white; }
        .taller-section { background: #fff9e6; border-left-color: #f1c40f; }
        .taller-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .taller-card {
            background: white;
            border-radius: 15px;
            padding: 18px;
            text-align: center;
            border-top: 5px solid;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .taller-card.oficio { border-top-color: #e67e22; }
        .taller-card.saber { border-top-color: #3498db; }
        .taller-card.corazon { border-top-color: #e74c3c; }
        .taller-icon { font-size: 2.5em; margin-bottom: 10px; }
        .taller-btn {
            margin-top: 12px;
            padding: 10px 15px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .taller-btn:hover { background: #34495e; }
        .day-summary {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px dashed #bdc3c7;
        }
        #activity-log {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        .log-entry {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        .log-time { color: #7f8c8d; font-size: 0.9em; }
        .log-activity { font-weight: 500; }
        .empty-log { text-align: center; color: #95a5a6; font-style: italic; padding: 20px; }
        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 0.9em;
        }
        .mission { font-size: 0.85em; opacity: 0.9; margin-top: 5px; }
        .highlight { color: #FFD700; font-weight: bold; }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        .close-modal {
            float: right;
            font-size: 1.8em;
            cursor: pointer;
            color: #7f8c8d;
        }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }
        .form-group input:focus, .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        .form-btn {
            width: 100%;
            padding: 15px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.3s;
        }
        .form-btn:hover { background: #27ae60; }
        .corazon-list { margin-top: 20px; }
        .corazon-item {
            background: #ffeaea;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #e74c3c;
        }
        @media (max-width: 600px) {
            h1 { font-size: 1.8em; }
            .animal-avatar { font-size: 2.2em; }
            .animal-large { font-size: 4em; }
            .activity-buttons { grid-template-columns: repeat(2, 1fr); }
            .activity-btn { min-height: 80px; padding: 18px 5px; }
            .taller-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü¶ä Refugio Patitas Negras</h1>
            <p class="tagline">Un espacio construido con Oficio, Saber y mucho Coraz√≥n</p>
        </header>

        <section id="welcome-screen" class="card refugio-header">
            <h2>¬°Bienvenido, Constructor!</h2>
            <p>Este es tu refugio digital. Eleg√≠ un compa√±ero animal que refleje tu esp√≠ritu y comenz√° a construir este espacio con tus acciones diarias.</p>
            <div class="form-group" style="margin-top:20px;">
                <label for="input-refugio-name">¬øC√≥mo se llama este refugio?</label>
                <input type="text" id="input-refugio-name" placeholder="Ej: Patitas Negras" value="Patitas Negras">
                <button id="btn-set-name" class="taller-btn" style="width:100%; margin-top:10px;">Guardar Nombre</button>
            </div>
        </section>

        <section id="animal-selection" class="card">
            <h2>Elige tu espejo animal</h2>
            <div class="animals-grid">
                <div class="animal-card" data-animal="fox">
                    <div class="animal-avatar">ü¶ä</div>
                    <h3>Zorro Constructor</h3>
                    <p>Astuto y h√°bil con las herramientas</p>
                </div>
                <div class="animal-card" data-animal="otter">
                    <div class="animal-avatar">ü¶¶</div>
                    <h3>Nutria Sabia</h3>
                    <p>Creativa y buena ense√±ando</p>
                </div>
                <div class="animal-card" data-animal="owl">
                    <div class="animal-avatar">ü¶â</div>
                    <h3>B√∫ho Solidario</h3>
                    <p>Observador y de gran coraz√≥n</p>
                </div>
            </div>
        </section>

        <section id="main-game" class="hidden">
            <div id="refugio-name" class="card refugio-header"></div>

            <div class="main-game-area">
                <section class="card avatar-section">
                    <div id="animal-display" class="animal-large">ü¶ä</div>
                    <div class="animal-status">
                        <h2 id="animal-name">Zorro Constructor</h2>
                        <p id="activity-status" style="color:#7f8c8d; margin-bottom:15px;">Preparado para construir</p>
                        <div class="stats-container">
                            <div class="stat">
                                <div class="stat-label">
                                    <span>üî© Oficio</span>
                                    <span id="oficio-value">65</span>
                                </div>
                                <div class="stat-bar"><div id="oficio-bar" class="stat-fill"></div></div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">
                                    <span>üìö Saber</span>
                                    <span id="saber-value">40</span>
                                </div>
                                <div class="stat-bar"><div id="saber-bar" class="stat-fill"></div></div>
                            </div>
                            <div class="stat">
                                <div class="stat-label">
                                    <span>‚ù§Ô∏è Coraz√≥n</span>
                                    <span id="corazon-value">80</span>
                                </div>
                                <div class="stat-bar"><div id="corazon-bar" class="stat-fill"></div></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="card activities-section">
                    <h3>Registr√° tu d√≠a</h3>
                    <p class="tagline" style="color:#666; margin-bottom:15px;">Cada acci√≥n suma puntos diferentes</p>
                    <div class="activity-buttons">
                        <button class="activity-btn oficio" data-activity="herramientas">üîß Usar Herramientas</button>
                        <button class="activity-btn oficio" data-activity="reparar">üõ†Ô∏è Reparar algo</button>
                        <button class="activity-btn saber" data-activity="estudiar">üìñ Estudiar/Ense√±ar</button>
                        <button class="activity-btn saber" data-activity="planear">‚úèÔ∏è Planear un proyecto</button>
                        <button class="activity-btn corazon" data-activity="escuchar">üëÇ Escuchar a alguien</button>
                        <button class="activity-btn corazon" data-activity="animar">üíù Animar a otra persona</button>
                    </div>

                    <div class="special-actions">
                        <button id="btn-alimentar" class="special-btn">ü•´ Aliment√© a un Callejerito</button>
                        <button id="btn-cambiar" class="special-btn">‚Ü∫ Cambiar Animal</button>
                        <button id="btn-reiniciar" class="special-btn">‚ö†Ô∏è Reiniciar Todo</button>
                    </div>
                </section>

                <section class="card taller-section">
                    <h3>üèóÔ∏è Tu Taller-Refugio</h3>
                    <p>Invert√≠ tus puntos para mejorar este espacio y ayudar a m√°s.</p>
                    <div class="taller-grid">
                        <div class="taller-card oficio">
                            <div class="taller-icon">üî©</div>
                            <h4>Banco de Trabajo</h4>
                            <p>Mejor√° tus herramientas</p>
                            <p><strong>Nivel:</strong> <span id="nivel-oficio">1</span></p>
                            <button class="taller-btn" data-taller="oficio" data-costo="50">Mejorar (50 Oficio)</button>
                        </div>
                        <div class="taller-card saber">
                            <div class="taller-icon">üìö</div>
                            <h4>Rinc√≥n del Saber</h4>
                            <p>Ampli√° tu biblioteca</p>
                            <p><strong>Nivel:</strong> <span id="nivel-saber">1</span></p>
                            <button class="taller-btn" data-taller="saber" data-costo="40">Ampliar (40 Saber)</button>
                        </div>
                        <div class="taller-card corazon">
                            <div class="taller-icon">‚ù§Ô∏è</div>
                            <h4>Jard√≠n del Refugio</h4>
                            <p>Ayud√° a m√°s animalitos</p>
                            <p><strong>Nivel:</strong> <span id="nivel-corazon">1</span></p>
                            <button class="taller-btn" data-taller="corazon" data-costo="60">Expandir (60 Coraz√≥n)</button>
                        </div>
                    </div>
                </section>

                <section class="card day-summary">
                    <h3>üìù Resumen de tu d√≠a</h3>
                    <div id="activity-log">
                        <p class="empty-log">A√∫n no hay actividades registradas. ¬°Empez√° a construir tu d√≠a!</p>
                    </div>
                </section>
            </div>
        </section>

        <footer>
            <p>‚ú® <span class="highlight">Refugio Patitas Negras</span> - Un proyecto construido con <span class="highlight">manos y coraz√≥n</span></p>
            <p class="mission">Cada punto de Coraz√≥n acerca este refugio a ayudar a animalitos reales.gracias tambien a accesorio.dl25 por su colaboracion</p>
        </footer>
    </div>

    <!-- Modal para registrar actos de bondad -->
    <div id="modal-corazon" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2>ü•´ Registr√° un acto de bondad</h2>
            <p>Este gesto suma <strong>Coraz√≥n</strong> a tu refugio y queda guardado en tu historia.</p>
            <div class="form-group">
                <label for="corazon-nombre">¬øC√≥mo llam√°s a este amigo?</label>
                <input type="text" id="corazon-nombre" placeholder="Ej: Negrito, Luna, Chiquito...">
            </div>
            <div class="form-group">
                <label for="corazon-desc">¬øQu√© hiciste? (opcional)</label>
                <textarea id="corazon-desc" placeholder="Ej: Le di comida y agua, le encontr√© un lugar abrigado..." rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Sub√≠ una foto (simulada)</label>
                <input type="file" id="corazon-foto" accept="image/*" style="padding:8px; border:2px dashed #ddd; border-radius:8px; width:100%;">
                <small style="color:#7f8c8d;">Nota: En esta versi√≥n, la foto se procesa localmente. No se sube a ning√∫n servidor.</small>
            </div>
            <button id="btn-guardar-corazon" class="form-btn">‚ú® Guardar y Sumar Coraz√≥n</button>
            <div class="corazon-list" id="lista-corazon" style="display:none;">
                <h3>Tus gestos registrados:</h3>
                <div id="corazon-container"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ESTADO DEL JUEGO ====================
        const gameState = {
            refugioName: "Patitas Negras",
            animal: null,
            stats: { oficio: 65, saber: 40, corazon: 80 },
            taller: { oficio: 1, saber: 1, corazon: 1 },
            actividades: [],
            actosCorazon: []
        };

        const animales = {
            fox: { emoji: 'ü¶ä', nombre: 'Zorro Constructor', efecto: 'Gan√°s +20% de Oficio' },
            otter: { emoji: 'ü¶¶', nombre: 'Nutria Sabia', efecto: 'Gan√°s +20% de Saber' },
            owl: { emoji: 'ü¶â', nombre: 'B√∫ho Solidario', efecto: 'Gan√°s +20% de Coraz√≥n' }
        };

        const actividades = {
            herramientas: { tipo: 'oficio', puntos: 15, nombre: 'Usaste herramientas', emoji: 'üîß' },
            reparar: { tipo: 'oficio', puntos: 25, nombre: 'Reparaste algo', emoji: 'üõ†Ô∏è' },
            estudiar: { tipo: 'saber', puntos: 20, nombre: 'Estudiaste/Ense√±aste', emoji: 'üìñ' },
            planear: { tipo: 'saber', puntos: 15, nombre: 'Planeaste un proyecto', emoji: '‚úèÔ∏è' },
            escuchar: { tipo: 'corazon', puntos: 20, nombre: 'Escuchaste a alguien', emoji: 'üëÇ' },
            animar: { tipo: 'corazon', puntos: 25, nombre: 'Animaste a otra persona', emoji: 'üíù' }
        };

        // ==================== INICIALIZACI√ìN ====================
        function init() {
            cargarEstado();
            setupEventos();
            actualizarUI();
            mostrarBienvenida();
        }

        function mostrarBienvenida() {
            document.getElementById('welcome-screen').classList.remove('hidden');
            document.getElementById('animal-selection').classList.add('hidden');
            document.getElementById('main-game').classList.add('hidden');
        }

        // ==================== EVENTOS ====================
        function setupEventos() {
            // Selecci√≥n de animal
            document.querySelectorAll('.animal-card').forEach(card => {
                card.addEventListener('click', () => {
                    const tipo = card.dataset.animal;
                    seleccionarAnimal(tipo);
                });
            });

            // Botones de actividad
            document.querySelectorAll('.activity-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const actividad = btn.dataset.activity;
                    realizarActividad(actividad);
                });
            });

            // Botones especiales
            document.getElementById('btn-alimentar').addEventListener('click', mostrarModalCorazon);
            document.getElementById('btn-cambiar').addEventListener('click', cambiarAnimal);
            document.getElementById('btn-reiniciar').addEventListener('click', reiniciarJuego);
            document.getElementById('btn-set-name').addEventListener('click', guardarNombreRefugio);
            document.getElementById('input-refugio-name').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') guardarNombreRefugio();
            });

            // Modal de Coraz√≥n
            document.getElementById('close-modal').addEventListener('click', cerrarModal);
            document.getElementById('btn-guardar-corazon').addEventListener('click', guardarActoCorazon);
            document.getElementById('corazon-foto').addEventListener('change', simularSubidaFoto);

            // Botones del Taller
            document.querySelectorAll('.taller-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tipo = btn.dataset.taller;
                    const costo = parseInt(btn.dataset.costo);
                    mejorarTaller(tipo, costo);
                });
            });

            // Cerrar modal haciendo clic fuera
            window.addEventListener('click', (e) => {
                if (e.target.id === 'modal-corazon') cerrarModal();
            });
        }

        // ==================== FUNCIONES PRINCIPALES ====================
        function guardarNombreRefugio() {
            const input = document.getElementById('input-refugio-name');
            const nombre = input.value.trim();
            if (nombre) {
                gameState.refugioName = nombre;
                document.getElementById('refugio-name').textContent = `Refugio: ${nombre}`;
                guardarEstado();
                alert(`¬°Perfecto! Este refugio se llamar√° "${nombre}"`);
                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('animal-selection').classList.remove('hidden');
            } else {
                alert('Por favor, pon√© un nombre para tu refugio.');
            }
        }

        function seleccionarAnimal(tipo) {
            gameState.animal = tipo;
            document.getElementById('animal-selection').classList.add('hidden');
            document.getElementById('main-game').classList.remove('hidden');
            document.getElementById('welcome-screen').classList.add('hidden');
            actualizarAnimalDisplay();
            guardarEstado();
            registrarActividad(`Elegiste a ${animales[tipo].nombre} como compa√±ero.`, 'üåü');
        }

        function realizarActividad(tipoActividad) {
            const act = actividades[tipoActividad];
            const multiplicador = gameState.animal === 'fox' && act.tipo === 'oficio' ? 1.2 :
                                gameState.animal === 'otter' && act.tipo === 'saber' ? 1.2 :
                                gameState.animal === 'owl' && act.tipo === 'corazon' ? 1.2 : 1;

            const puntosGanados = Math.floor(act.puntos * multiplicador);
            gameState.stats[act.tipo] = Math.min(100, gameState.stats[act.tipo] + puntosGanados);

            const fecha = new Date();
            const hora = fecha.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });

            gameState.actividades.push({
                hora: hora,
                actividad: act.nombre,
                puntos: puntosGanados,
                tipo: act.tipo,
                emoji: act.emoji
            });

            // Efecto visual
            const display = document.getElementById('animal-display');
            display.textContent = animales[gameState.animal].emoji + act.emoji;
            display.style.transform = 'scale(1.2)';
            setTimeout(() => {
                display.style.transform = 'scale(1)';
                display.textContent = animales[gameState.animal].emoji;
            }, 500);

            document.getElementById('activity-status').textContent = `${act.emoji} ${act.nombre}...`;
            actualizarUI();
            guardarEstado();
        }

        function mostrarModalCorazon() {
            document.getElementById('modal-corazon').style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('modal-corazon').style.display = 'none';
            // Limpiar formulario
            document.getElementById('corazon-nombre').value = '';
            document.getElementById('corazon-desc').value = '';
            document.getElementById('corazon-foto').value = '';
        }

        function simularSubidaFoto(e) {
            const file = e.target.files[0];
            if (file) {
                console.log(`[Simulaci√≥n] Foto seleccionada: ${file.name} (${Math.round(file.size/1024)} KB)`);
                alert('‚úÖ Foto procesada localmente. En una versi√≥n futura, esta foto se guardar√≠a en tu galer√≠a del refugio.');
            }
        }

        function guardarActoCorazon() {
            const nombre = document.getElementById('corazon-nombre').value.trim();
            if (!nombre) {
                alert('Por favor, pon√© un nombre para recordar a este amigo.');
                return;
            }

            const desc = document.getElementById('corazon-desc').value.trim() || 'Le di comida y cuidado.';
            const puntosCorazon = 30;

            gameState.stats.corazon = Math.min(100, gameState.stats.corazon + puntosCorazon);

            const fecha = new Date();
            const fechaFormateada = fecha.toLocaleDateString('es-AR', { day: 'numeric', month: 'long' });

            gameState.actosCorazon.push({
                fecha: fechaFormateada,
                nombre: nombre,
                desc: desc,
                puntos: puntosCorazon
            });

            registrarActividad(`Alimentaste y cuidaste a "${nombre}".`, 'ü•´', puntosCorazon);
            actualizarUI();
            guardarEstado();
            cerrarModal();

            // Mostrar lista de actos si hay m√°s de uno
            if (gameState.actosCorazon.length > 0) {
                document.getElementById('lista-corazon').style.display = 'block';
                actualizarListaCorazon();
            }

            alert(`‚ú® ¬°Sumaste ${puntosCorazon} puntos de Coraz√≥n por ayudar a ${nombre}!`);
        }

        function actualizarListaCorazon() {
            const container = document.getElementById('corazon-container');
            container.innerHTML = '';
            gameState.actosCorazon.slice().reverse().forEach(acto => {
                const div = document.createElement('div');
                div.className = 'corazon-item';
                div.innerHTML = `
                    <strong>${acto.nombre}</strong> - <em>${acto.fecha}</em>
                    <p style="margin-top:5px; color:#666;">${acto.desc}</p>
                    <small>+${acto.puntos} ‚ù§Ô∏è</small>
                `;
                container.appendChild(div);
            });
        }

        function mejorarTaller(tipo, costo) {
            if (gameState.stats[tipo] >= costo) {
                gameState.stats[tipo] -= costo;
                gameState.taller[tipo]++;
                actualizarUI();
                guardarEstado();
                registrarActividad(`Mejoraste el ${tipo === 'oficio' ? 'Banco de Trabajo' : tipo === 'saber' ? 'Rinc√≥n del Saber' : 'Jard√≠n del Refugio'} a nivel ${gameState.taller[tipo]}.`, 'üèóÔ∏è');
                alert(`‚úÖ ¬°Mejoraste a nivel ${gameState.taller[tipo]}!`);
            } else {
                alert(`‚ùå No ten√©s suficiente ${tipo === 'oficio' ? 'Oficio' : tipo === 'saber' ? 'Saber' : 'Coraz√≥n'}. Necesit√°s ${costo} puntos.`);
            }
        }

        function cambiarAnimal() {
            if (confirm("¬øVolver a elegir animal? Tu progreso se guardar√°, pero perder√°s las actividades de hoy.")) {
                document.getElementById('main-game').classList.add('hidden');
                document.getElementById('animal-selection').classList.remove('hidden');
                registrarActividad('Cambiaste de compa√±ero animal.', 'üîÑ');
            }
        }

        function reiniciarJuego() {
            if (confirm("‚ö†Ô∏è ¬øEST√ÅS SEGURO? Esto borrar√° TODO tu progreso: animal, puntos, taller y actividades. No se puede deshacer.")) {
                localStorage.removeItem('refugioPatitasNegras');
                location.reload();
            }
        }

        function registrarActividad(texto, emoji = 'üìù', puntos = null) {
            const fecha = new Date();
            const hora = fecha.toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' });
            const log = document.getElementById('activity-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">${hora}</span>
                <span class="log-activity">${emoji} ${texto} ${puntos ? `<strong>(+${puntos})</strong>` : ''}</span>
            `;
            // Si est√° el mensaje vac√≠o, lo removemos
            const emptyMsg = log.querySelector('.empty-log');
            if (emptyMsg) emptyMsg.remove();
            log.prepend(entry);
            log.scrollTop = 0;
        }

        // ==================== UI Y ESTADO ====================
        function actualizarUI() {
            // Nombre del refugio
            document.getElementById('refugio-name').textContent = `Refugio: ${gameState.refugioName}`;

            // Animal
            if (gameState.animal) {
                actualizarAnimalDisplay();
            }

            // Stats
            document.getElementById('oficio-value').textContent = gameState.stats.oficio;
            document.getElementById('saber-value').textContent = gameState.stats.saber;
            document.getElementById('corazon-value').textContent = gameState.stats.corazon;
            document.getElementById('oficio-bar').style.width = `${gameState.stats.oficio}%`;
            document.getElementById('saber-bar').style.width = `${gameState.stats.saber}%`;
            document.getElementById('corazon-bar').style.width = `${gameState.stats.corazon}%`;

            // Niveles del Taller
            document.getElementById('nivel-oficio').textContent = gameState.taller.oficio;
            document.getElementById('nivel-saber').textContent = gameState.taller.saber;
            document.getElementById('nivel-corazon').textContent = gameState.taller.corazon;

            // Actualizar costos de los botones del taller
            document.querySelectorAll('.taller-btn[data-taller="oficio"]').forEach(btn => {
                btn.dataset.costo = 50 * gameState.taller.oficio;
                btn.textContent = `Mejorar (${50 * gameState.taller.oficio} Oficio)`;
            });
            document.querySelectorAll('.taller-btn[data-taller="saber"]').forEach(btn => {
                btn.dataset.costo = 40 * gameState.taller.saber;
                btn.textContent = `Ampliar (${40 * gameState.taller.saber} Saber)`;
            });
            document.querySelectorAll('.taller-btn[data-taller="corazon"]').forEach(btn => {
                btn.dataset.costo = 60 * gameState.taller.corazon;
                btn.textContent = `Expandir (${60 * gameState.taller.corazon} Coraz√≥n)`;
            });

            // Actualizar color de barras seg√∫n nivel
            actualizarColorBarras();
        }

        function actualizarAnimalDisplay() {
            if (gameState.animal) {
                const animal = animales[gameState.animal];
                document.getElementById('animal-display').textContent = animal.emoji;
                document.getElementById('animal-name').textContent = animal.nombre;
                document.getElementById('activity-status').textContent = animal.efecto;
            }
        }

        function actualizarColorBarras() {
            const colores = {
                bajo: 'linear-gradient(90deg, #FF5252, #FF8A80)',
                medio: 'linear-gradient(90deg, #FFB74D, #FFD54F)',
                alto: 'linear-gradient(90deg, #4CAF50, #8BC34A)'
            };

            function setColor(barId, valor) {
                const bar = document.getElementById(barId);
                if (valor < 30) bar.style.background = colores.bajo;
                else if (valor < 70) bar.style.background = colores.medio;
                else bar.style.background = colores.alto;
            }

            setColor('oficio-bar', gameState.stats.oficio);
            setColor('saber-bar', gameState.stats.saber);
            setColor('corazon-bar', gameState.stats.corazon);
        }

        function guardarEstado() {
            localStorage.setItem('refugioPatitasNegras', JSON.stringify(gameState));
        }

        function cargarEstado() {
            const guardado = localStorage.getItem('refugioPatitasNegras');
            if (guardado) {
                const data = JSON.parse(guardado);
                Object.assign(gameState, data);
                // Mostrar el nombre cargado en el input
                document.getElementById('input-refugio-name').value = gameState.refugioName;
                // Si ya hay un animal seleccionado, mostrar el juego principal
                if (gameState.animal) {
                    document.getElementById('welcome-screen').classList.add('hidden');
                    document.getElementById('animal-selection').classList.add('hidden');
                    document.getElementById('main-game').classList.remove('hidden');
                }
                // Cargar actividades en el log
                if (gameState.actividades.length > 0) {
                    const log = document.getElementById('activity-log');
                    const emptyMsg = log.querySelector('.empty-log');
                    if (emptyMsg) emptyMsg.remove();
                    gameState.actividades.slice().reverse().forEach(act => {
                        const entry = document.createElement('div');
                        entry.className = 'log-entry';
                        entry.innerHTML = `
                            <span class="log-time">${act.hora}</span>
                            <span class="log-activity">${act.emoji || 'üìù'} ${act.actividad} <strong>(+${act.puntos})</strong></span>
                        `;
                        log.prepend(entry);
                    });
                }
                // Cargar actos de coraz√≥n
                if (gameState.actosCorazon.length > 0) {
                    actualizarListaCorazon();
                    document.getElementById('lista-corazon').style.display = 'block';
                }
            }
        }

        // Iniciar el juego cuando se carga la p√°gina
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
